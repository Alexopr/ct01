# üèóÔ∏è –î–∏–∑–∞–π–Ω –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã CT.01

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

### ‚úÖ –°–æ–∑–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤:

```
src/main/java/alg/coyote001/
‚îú‚îÄ‚îÄ core/                    # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–±—â–∏–µ)
‚îÇ   ‚îú‚îÄ‚îÄ security/           # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–æ–±—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ exception/          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ util/               # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ user/                   # –ú–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ controller/         # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ service/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ repository/         # –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ   ‚îú‚îÄ‚îÄ entity/             # JPA —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ dto/                # Data Transfer Objects
‚îÇ
‚îú‚îÄ‚îÄ subscription/           # –ú–æ–¥—É–ª—å –ø–æ–¥–ø–∏—Å–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îÇ
‚îú‚îÄ‚îÄ crypto/                 # –ú–æ–¥—É–ª—å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
‚îÇ   ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îî‚îÄ‚îÄ exchange/          # –ê–¥–∞–ø—Ç–µ—Ä—ã –±–∏—Ä–∂
‚îÇ
‚îú‚îÄ‚îÄ market/                 # –ú–æ–¥—É–ª—å —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îÇ
‚îú‚îÄ‚îÄ notification/           # –ú–æ–¥—É–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ websocket/         # WebSocket handlers
‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îÇ
‚îî‚îÄ‚îÄ admin/                  # –ú–æ–¥—É–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îú‚îÄ‚îÄ controller/
    ‚îú‚îÄ‚îÄ service/
    ‚îî‚îÄ‚îÄ dto/
```

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **–î–æ–º–µ–Ω–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (Domain-Driven Design)**
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω
- –ß–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –º–µ–∂–º–æ–¥—É–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 2. **–°–ª–æ–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª–µ–π**
```
Controller Layer ‚Üí Service Layer ‚Üí Repository Layer ‚Üí Entity Layer
     ‚Üì                ‚Üì               ‚Üì                ‚Üì
   HTTP             Business        Data Access     Database
  Handling           Logic          Abstraction      Entities
```

### 3. **Dependency Rules**
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å:** Controller ‚Üí Service ‚Üí Repository ‚Üí Entity
- **–ó–∞–ø—Ä–µ—Ç –∫—Ä—É–≥–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏** –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

## üìã –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

### üìÅ –ü–∞–∫–µ—Ç—ã
```java
// –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
alg.coyote001.crypto.controller
alg.coyote001.crypto.service
alg.coyote001.crypto.repository

// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
alg.coyote001.controllers.crypto
alg.coyote001.service.crypto
```

### üè∑Ô∏è –ö–ª–∞—Å—Å—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

#### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
```java
// –ù–æ–≤—ã–π —Å—Ç–∏–ª—å (–º–æ–¥—É–ª—å–Ω—ã–π):
@RestController
@RequestMapping("/api/v1/crypto/coins")
public class CoinController { ... }

@RestController  
@RequestMapping("/api/v1/crypto/tracking")
public class TrackingController { ... }

// –°—Ç–∞—Ä—ã–π —Å—Ç–∏–ª—å (deprecated):
@RestController
@RequestMapping("/api/v1/coins")
@Deprecated
public class CoinDataController { ... }
```

#### –°–µ—Ä–≤–∏—Å—ã
```java
// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
public interface CoinService { ... }

@Service
public class CoinServiceImpl implements CoinService { ... }

// –î–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
@Service
public class CoinPriceService { ... }

@Service
public class CoinTrackingService { ... }
```

#### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
```java
// JPA —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
@Repository
public interface CoinRepository extends JpaRepository<Coin, Long> { ... }

// –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
public interface CoinCustomRepository { ... }

@Repository
public class CoinCustomRepositoryImpl implements CoinCustomRepository { ... }
```

### üîó API –ú–∞—Ä—à—Ä—É—Ç—ã (–Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

#### ‚úÖ –ù–æ–≤—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:

```java
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
/api/v1/auth/*                    - AuthController
/api/v1/users/*                   - UserController  
/api/v1/users/{id}/settings       - UserSettingsController

// –ü–æ–¥–ø–∏—Å–∫–∏
/api/v1/subscriptions/*           - SubscriptionController

// –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã (–æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω)
/api/v1/crypto/coins/*            - CoinController
/api/v1/crypto/tracking/*         - TrackingController
/api/v1/crypto/watchlists/*       - WatchlistController

// –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  
/api/v1/exchanges/*               - ExchangeController
/api/v1/market/prices/*           - PriceController
/api/v1/market/tickers/*          - TickerController

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
/api/v1/realtime/websocket/*      - WebSocketController
/api/v1/notifications/*           - NotificationController

// –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
/api/v1/admin/system/*            - SystemController
/api/v1/admin/analysis/*          - AnalysisController
```

#### ‚ùå –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ + deprecation):
```java
/api/v1/coins ‚Üí /api/v1/crypto/coins
/api/v1/tracked-coins ‚Üí /api/v1/crypto/tracking
/api/v1/prices ‚Üí /api/v1/market/prices
/api/v1/websocket ‚Üí /api/v1/realtime/websocket
/api/v1/system ‚Üí /api/v1/admin/system
/api/v1/analysis ‚Üí /api/v1/admin/analysis
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã

### üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
```java
@RestController
@RequestMapping("/api/v1/crypto/coins")
@Tag(name = "Crypto Coins", description = "API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏")
@RequiredArgsConstructor
@Slf4j
@Validated
public class CoinController {
    
    private final CoinService coinService;
    
    @GetMapping
    @Operation(summary = "–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–Ω–µ—Ç")
    public ResponseEntity<Page<CoinDto>> getCoins(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "20") int size) {
        // Implementation
    }
}
```

### üéØ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞
```java
@Service
@RequiredArgsConstructor
@Slf4j
@Transactional(readOnly = true)
public class CoinServiceImpl implements CoinService {
    
    private final CoinRepository coinRepository;
    private final CoinMapper coinMapper;
    
    @Override
    @Cacheable("coins")
    public Page<CoinDto> getCoins(Pageable pageable) {
        // Implementation
    }
    
    @Override
    @Transactional
    public CoinDto createCoin(CreateCoinRequest request) {
        // Implementation  
    }
}
```

### üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```java
@Repository
public interface CoinRepository extends JpaRepository<Coin, Long> {
    
    @Query("SELECT c FROM Coin c WHERE c.symbol = :symbol")
    Optional<Coin> findBySymbol(@Param("symbol") String symbol);
    
    @Query("SELECT c FROM Coin c WHERE c.isActive = true")
    List<Coin> findActiveCoins();
}
```

## üìä –ú–µ–∂–º–æ–¥—É–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

### üîó –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```
core ‚Üê –≤—Å–µ –º–æ–¥—É–ª–∏ (–æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
user ‚Üî subscription (–ª–∏–º–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
crypto ‚Üî market (—Ü–µ–Ω—ã –º–æ–Ω–µ—Ç)
crypto ‚Üî notification (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ü–µ–Ω–∞—Ö)
admin ‚Üí –≤—Å–µ –º–æ–¥—É–ª–∏ (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
```

### ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- –ü—Ä—è–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É subscription ‚Üî market
- –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ repository –¥—Ä—É–≥–æ–≥–æ –º–æ–¥—É–ª—è –Ω–∞–ø—Ä—è–º—É—é

### üõ†Ô∏è –ú–µ—Ö–∞–Ω–∏–∑–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:

#### 1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –º–æ–¥—É–ª–µ–π**
```java
// –í core –º–æ–¥—É–ª–µ:
public interface CryptoFacade {
    List<CoinDto> getActiveCoins();
    Optional<CoinDto> getCoinBySymbol(String symbol);
}

// –í crypto –º–æ–¥—É–ª–µ:
@Component
public class CryptoFacadeImpl implements CryptoFacade {
    // Implementation
}
```

#### 2. **–°–æ–±—ã—Ç–∏—è (Spring Events)**
```java
// –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è:
@EventListener
public void handlePriceUpdate(PriceUpdateEvent event) {
    applicationEventPublisher.publishEvent(
        new CoinPriceChangedEvent(event.getCoinSymbol(), event.getNewPrice())
    );
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è:
@EventListener
public void onCoinPriceChanged(CoinPriceChangedEvent event) {
    notificationService.sendPriceAlert(event);
}
```

#### 3. **Configuration Properties**
```java
@ConfigurationProperties(prefix = "app.modules")
@Data
public class ModuleProperties {
    private CryptoModuleProperties crypto;
    private MarketModuleProperties market;
    private NotificationModuleProperties notification;
}
```

## üß™ –ü—Ä–∞–≤–∏–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit Tests
```java
@ExtendWith(MockitoExtension.class)
class CoinServiceTest {
    
    @Mock
    private CoinRepository coinRepository;
    
    @InjectMocks
    private CoinServiceImpl coinService;
    
    // Tests
}
```

### Integration Tests
```java
@SpringBootTest
@DataJpaTest
@TestPropertySource(locations = "classpath:test.properties")
class CoinRepositoryTest {
    // Repository integration tests
}
```

### API Tests
```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc
class CoinControllerIntegrationTest {
    // API integration tests
}
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –º–∏–≥—Ä–∞—Ü–∏—è

### üìñ Swagger/OpenAPI
```java
@Tag(name = "Crypto Coins", description = "API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏")
@ApiResponses(value = {
    @ApiResponse(responseCode = "200", description = "–£—Å–ø–µ—à–Ω–æ"),
    @ApiResponse(responseCode = "404", description = "–ù–µ –Ω–∞–π–¥–µ–Ω–æ")
})
```

### ‚ö†Ô∏è Deprecation Strategy
```java
@RestController
@RequestMapping("/api/v1/coins")
@Deprecated(since = "1.5.0", forRemoval = true)
@Tag(name = "Coins (Deprecated)", 
     description = "‚ö†Ô∏è –£–°–¢–ê–†–ï–õ–û: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /api/v1/crypto/coins")
public class CoinDataController {
    
    @GetMapping
    @Deprecated(since = "1.5.0", forRemoval = true)
    @Operation(
        summary = "‚ö†Ô∏è –£–°–¢–ê–†–ï–õ–û: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GET /api/v1/crypto/coins",
        description = "–≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –≤ –≤–µ—Ä—Å–∏–∏ 2.0.0"
    )
    public ResponseEntity<Page<CoinDto>> getAllCoins() {
        // Redirect to new implementation
        return cryptoFacade.getCoins();
    }
}
```

## üöÄ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### Phase 1: Core + Crypto (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤
2. ‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ core –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. ‚è≥ –ú–∏–≥—Ä–∞—Ü–∏—è crypto –º–æ–¥—É–ª—è
4. ‚è≥ –ù–æ–≤—ã–µ API –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è crypto

### Phase 2: Market + User
1. –ú–∏–≥—Ä–∞—Ü–∏—è market –¥–∞–Ω–Ω—ã—Ö  
2. –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è user/auth –º–æ–¥—É–ª–µ–π

### Phase 3: Subscription + Notification
1. –ú–æ–¥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫
2. –í—ã–Ω–µ—Å–µ–Ω–∏–µ WebSocket –≤ notification

### Phase 4: Admin + Cleanup
1. –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è admin —Ñ—É–Ω–∫—Ü–∏–π
2. –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---
*–≠—Ç–æ—Ç –¥–∏–∑–∞–π–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏* 