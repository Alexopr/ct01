# 🏗️ План модуляризации и реорганизации API CT.01

## 📊 Текущее состояние

### Текущие API маршруты:
```
/api/v1/auth              - Аутентификация
/api/v1/users             - Управление пользователями  
/api/v1/subscriptions     - Подписки и лимиты
/api/v1/settings          - Настройки пользователей
/api/v1/system            - Системная информация
/api/v1/analysis          - Анализ API
/api/v1/websocket         - WebSocket статистика

/api/v1/coins             - Данные монет
/api/v1/tracked-coins     - Отслеживаемые монеты (конфликт)
/api/v1/exchanges         - Биржи
/api/v1/prices            - Обновление цен
```

### Проблемы:
1. **Отсутствие модульности** - все в одном большом пакете
2. **Неоднородное именование** - `/coins` vs `/tracked-coins` vs `/prices`
3. **Смешение концепций** - пользователи и криптовалюты в одном уровне
4. **Монолитная структура** - 111 классов в одной иерархии

## 🎯 Предлагаемая модульная архитектура

### 1. Разделение на доменные модули

```
src/main/java/alg/coyote001/
├── core/                 # Общие компоненты
│   ├── config/
│   ├── security/
│   ├── exception/
│   ├── util/
│   └── Application.java
│
├── user/                 # Модуль пользователей
│   ├── controller/
│   ├── service/
│   ├── repository/
│   ├── entity/
│   └── dto/
│
├── subscription/         # Модуль подписок
│   ├── controller/
│   ├── service/
│   ├── repository/
│   ├── entity/
│   └── dto/
│
├── crypto/              # Модуль криптовалют
│   ├── controller/
│   ├── service/
│   ├── repository/
│   ├── entity/
│   ├── dto/
│   └── exchange/        # Адаптеры бирж
│
├── market/              # Модуль рыночных данных
│   ├── controller/
│   ├── service/
│   ├── repository/
│   ├── entity/
│   └── dto/
│
├── notification/        # Модуль уведомлений
│   ├── controller/
│   ├── service/
│   ├── websocket/
│   └── dto/
│
└── admin/              # Модуль администрирования
    ├── controller/
    ├── service/
    └── dto/
```

## 🔄 Новая структура API маршрутов

### RESTful и логичная иерархия:

```
# Пользователи и аутентификация
/api/v1/auth/                    # Аутентификация
├── POST /login
├── POST /logout  
├── POST /register
├── GET  /csrf-token
└── POST /telegram

/api/v1/users/                   # Управление пользователями
├── GET    /                     # Список пользователей (admin)
├── POST   /                     # Создать пользователя (admin)
├── GET    /{userId}             # Профиль пользователя
├── PUT    /{userId}             # Обновить пользователя
├── DELETE /{userId}             # Удалить пользователя (admin)
├── GET    /{userId}/settings    # Настройки пользователя
└── PUT    /{userId}/settings    # Обновить настройки

# Подписки и биллинг
/api/v1/subscriptions/           # Управление подписками
├── GET  /plans                  # Доступные планы
├── GET  /current                # Текущая подписка
├── POST /upgrade                # Обновить подписку
├── GET  /usage                  # Использование лимитов
└── GET  /usage/{module}         # Лимиты модуля

# Криптовалюты (основной домен)
/api/v1/crypto/                  # Корневой путь криптовалют
├── coins/                       # Справочник монет
│   ├── GET    /                 # Список всех монет
│   ├── GET    /{symbol}         # Информация о монете
│   └── GET    /{symbol}/info    # Детальная информация
│
├── tracking/                    # Отслеживание монет
│   ├── GET    /                 # Отслеживаемые монеты
│   ├── POST   /                 # Добавить в отслеживание
│   ├── GET    /{id}             # Детали отслеживания
│   ├── PUT    /{id}             # Обновить отслеживание
│   └── DELETE /{id}             # Удалить из отслеживания
│
└── watchlists/                  # Списки наблюдения
    ├── GET    /                 # Пользовательские списки
    ├── POST   /                 # Создать список
    ├── GET    /{listId}         # Детали списка
    ├── PUT    /{listId}         # Обновить список
    └── DELETE /{listId}         # Удалить список

# Биржи и рыночные данные  
/api/v1/exchanges/               # Биржи
├── GET    /                     # Список бирж
├── GET    /active               # Активные биржи
├── GET    /{name}               # Информация о бирже
├── GET    /{name}/status        # Статус биржи
├── GET    /{name}/pairs         # Торговые пары
└── GET    /{name}/stats         # Статистика биржи

/api/v1/market/                  # Рыночные данные
├── prices/                      # Цены
│   ├── GET    /current          # Текущие цены
│   ├── GET    /history          # История цен
│   ├── POST   /update           # Обновить цены (admin)
│   └── GET    /status           # Статус обновлений
│
├── tickers/                     # Тикеры
│   ├── GET    /                 # Все тикеры
│   ├── GET    /{symbol}         # Тикер по символу
│   └── GET    /{symbol}/24h     # 24h статистика
│
└── candles/                     # Свечные данные
    ├── GET /{symbol}            # OHLCV данные
    └── GET /{symbol}/realtime   # Реальное время

# Уведомления и WebSocket
/api/v1/notifications/           # Уведомления
├── GET    /                     # Список уведомлений
├── POST   /                     # Создать уведомление  
├── PUT    /{id}/read            # Отметить прочитанным
└── DELETE /{id}                 # Удалить уведомление

/api/v1/realtime/               # Реальное время
├── GET /websocket/stats        # Статистика WebSocket
├── GET /websocket/connections  # Активные соединения
└── GET /events                 # Поток событий

# Администрирование
/api/v1/admin/                   # Администрирование
├── system/                      # Системная информация
│   ├── GET /info                # Информация о системе
│   ├── GET /health              # Состояние здоровья
│   └── GET /metrics             # Метрики
│
├── analysis/                    # Анализ системы
│   ├── GET    /endpoints        # Обнаружение API
│   ├── POST   /endpoints/save   # Сохранить анализ
│   └── GET    /endpoints/report # Отчет анализа
│
└── maintenance/                 # Обслуживание
    ├── POST /cache/clear        # Очистить кеш
    ├── POST /db/migrate         # Миграции БД
    └── GET  /logs               # Системные логи
```

## 📦 Поэтапный план рефакторинга

### Этап 1: Создание модульной структуры пакетов
1. Создать новые пакеты модулей
2. Перенести существующие классы в соответствующие модули
3. Обновить импорты

### Этап 2: Реорганизация API маршрутов
1. Создать новые контроллеры с логичными маршрутами
2. Сохранить старые маршруты для обратной совместимости
3. Добавить deprecation warnings

### Этап 3: Рефакторинг сервисов
1. Разделить большие сервисы на специализированные
2. Создать четкие интерфейсы между модулями
3. Добавить модульные конфигурации

### Этап 4: Миграция клиентов
1. Обновить фронтенд для использования новых API
2. Документировать новые эндпоинты
3. Удалить устаревшие маршруты

## 🎨 Преимущества новой архитектуры

### Модульность
- **Четкое разделение** доменов и ответственности
- **Независимое развитие** модулей
- **Переиспользование** общих компонентов

### Масштабируемость  
- **Легкое добавление** новых функций
- **Возможность выделения** модулей в микросервисы
- **Горизонтальное масштабирование** по доменам

### Поддерживаемость
- **Понятная структура** для новых разработчиков
- **Логичное именование** API эндпоинтов
- **Четкая документация** и навигация

### REST-совместимость
- **Стандартизированные** HTTP методы
- **Иерархическая структура** ресурсов
- **Предсказуемые** URL паттерны

## 🚀 Начинаем с...

1. **Создаем модульную структуру** пакетов
2. **Рефакторим crypto модуль** как пример
3. **Тестируем** и валидируем подход
4. **Применяем ко всем** остальным модулям

Это позволит сохранить работоспособность и поэтапно улучшить архитектуру! 